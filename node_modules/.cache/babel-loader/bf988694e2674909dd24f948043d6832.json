{"ast":null,"code":"import React from 'react';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport moment from 'moment';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css = \".health-record__header {\\n  font-family: 'Open Sans', sans-serif;\\n  display: -ms-flexbox;\\n  display: flex;\\n  color: #6b8eb6;\\n  font-size: 1em;\\n  font-weight: bold;\\n  text-transform: uppercase;\\n  margin: 40px 0;\\n}\\n​\\n.health-record__header .header-divider {\\n  width: 100%;\\n  border-bottom: 1px solid #7e90a3;\\n  margin-bottom: 10px;\\n}\\n​\\n.report-line {\\n  background: #EAEAEA;\\n}\\n​\\ndl {\\n  margin-top:0;\\n  margin-bottom:20px\\n}\\n\\ndd,dt {\\n  line-height:1.42857\\n}\\n\\ndt {\\n  font-weight:700\\n}\\n\\ndd {\\n  margin-left:0\\n}\\n.dl-horizontal dd:after,.dl-horizontal dd:before {\\n  content:\\\" \\\";\\n  display:table\\n}\\n\\n.dl-horizontal dd:after {\\n  clear:both\\n}\\n\\n@media (min-width:768px) {\\n  .dl-horizontal dt {\\n    float:left;\\n    clear:left;\\n    text-align:right;\\n    overflow:hidden;\\n    text-overflow:ellipsis;\\n    white-space:nowrap\\n  }\\n  .dl-horizontal dd {\\n    margin-left:180px\\n  }\\n}\\n\";\nstyleInject(css);\nconst DSTU2 = '1.0.2';\nconst STU3 = '3.0.1';\nconst R4 = '4.0.0';\n\nconst round = function (num, digits) {\n  return Number.parseFloat(num).toFixed(digits);\n};\n\nconst FORMATTERS = {\n  date: str => moment(str).format('YYYY-MM-DD'),\n  time: str => moment(str).format('HH:mm:ss'),\n  dateTime: str => moment(str).format('YYYY-MM-DD - h:mm:ss a'),\n  numberWithCommas: str => str.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\")\n};\n\nconst obsValue = entry => {\n  if (entry == null) {\n    return '';\n  } else if (entry.valueQuantity) {\n    return round(entry.valueQuantity.value, 2) + ' ' + entry.valueQuantity.code;\n  } else if (entry.valueCodeableConcept) {\n    return entry.valueCodeableConcept.coding[0].display;\n  } else if (entry.valueString) {\n    return entry.valueString;\n  }\n\n  if (entry.code.coding[0].display === \"Blood Pressure\") {\n    if (!entry.component[0].valueQuantity) {\n      return ''; // WTF!!\n    }\n\n    const v1 = Number.parseFloat(entry.component[0].valueQuantity.value);\n    const v2 = Number.parseFloat(entry.component[1].valueQuantity.value);\n    const s1 = v1.toFixed(0);\n    const s2 = v2.toFixed(0);\n\n    if (v1 > v2) {\n      return s1 + ' / ' + s2 + ' mmHg';\n    } else {\n      return s2 + ' / ' + s1 + ' mmHg';\n    }\n  }\n\n  return '';\n};\n\nconst duration = period => {\n  if (!period.end) {\n    return '';\n  }\n\n  let start = moment(period.start);\n  let end = moment(period.end);\n  return moment.duration(start.diff(end)).humanize();\n};\n\nclass PatientVisualizer extends React.Component {\n  render() {\n    const patient = this.props.patient;\n    patient.extension = patient.extension || [];\n    const raceExt = patient.extension.find(e => {\n      return e.url === 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-race';\n    });\n    let race;\n\n    if (raceExt) {\n      race = raceExt.extension[0].valueString || raceExt.extension[0].valueCoding.display;\n    } else {\n      race = null;\n    }\n\n    const ethExt = patient.extension.find(e => {\n      return e.url === 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity';\n    });\n    let ethnicity;\n\n    if (ethExt) {\n      ethnicity = ethExt.extension[0].valueString || ethExt.extension[0].valueCoding.display;\n    } else {\n      ethnicity = null;\n    }\n\n    let language = null;\n\n    if (patient.communication && patient.communication[0] && patient.communication[0].language && patient.communication[0].language.coding && patient.communication[0].language.coding[0]) {\n      language = patient.communication[0].language.coding[0].display;\n    }\n\n    const observations = this.props.observations || [];\n    const searchableObs = observations.slice().reverse();\n    const height_obs = searchableObs.find(o => o.code.coding[0].display === 'Body Height');\n    const weight_obs = searchableObs.find(o => o.code.coding[0].display === 'Body Weight');\n    const cause_of_death_obs = null;\n    let lat, lng;\n\n    if (patient.address[0].extension) {\n      const geolocation = patient.address[0].extension.find(e => e.url === 'http://hl7.org/fhir/StructureDefinition/geolocation');\n\n      if (geolocation && geolocation.extension.length > 1) {\n        lat = geolocation.extension.find(e => e.url === 'latitude').valueDecimal;\n        lng = geolocation.extension.find(e => e.url === 'longitude').valueDecimal;\n      }\n    }\n\n    return React.createElement(\"div\", null, React.createElement(\"div\", {\n      className: \"health-record__header\"\n    }, React.createElement(\"div\", {\n      className: \"header-title\"\n    }, \"Patient\"), React.createElement(\"div\", {\n      className: \"header-divider\"\n    })), React.createElement(\"div\", {\n      id: \"p_brief\",\n      className: \"row\"\n    }, React.createElement(\"div\", {\n      id: \"p_brief_records\",\n      className: \"col-6\"\n    }, React.createElement(\"div\", {\n      id: \"p_brief_name_address\",\n      className: \"p_block\"\n    }, React.createElement(\"dl\", {\n      className: \"dl-horizontal p_brief_family\"\n    }, React.createElement(\"dt\", null, \"Name\"), React.createElement(\"dd\", null, patient.name[0].family, \", \", patient.name[0].given.join(' ')), React.createElement(\"dt\", null, \"Gender\"), React.createElement(\"dd\", null, patient.gender), React.createElement(\"dt\", null, \"Date of Birth\"), React.createElement(\"dd\", null, patient.birthDate), React.createElement(\"dt\", null, \"Address\"), React.createElement(\"dd\", null, patient.address[0].line.join(' ')), React.createElement(\"dt\", null, \"City, State\"), React.createElement(\"dd\", null, patient.address[0].city, \", \", patient.address[0].state), React.createElement(\"dt\", null, \"Postal Code\"), React.createElement(\"dd\", null, patient.address[0].postalCode), patient.deceasedDateTime && React.createElement(React.Fragment, null, React.createElement(\"dt\", null, \"Date of Death\"), React.createElement(\"dd\", null, patient.deceasedDateTime))))), React.createElement(\"div\", {\n      id: \"p_brief_records\",\n      className: \"col-6\"\n    }, React.createElement(\"div\", {\n      id: \"p_brief_name_address\",\n      className: \"p_block\"\n    }, React.createElement(\"dl\", {\n      className: \"dl-horizontal p_brief_family\"\n    }, React.createElement(\"dt\", null, \"Height\"), React.createElement(\"dd\", null, obsValue(height_obs)), React.createElement(\"dt\", null, \"Weight\"), React.createElement(\"dd\", null, obsValue(weight_obs)), React.createElement(\"dt\", null, \"Race\"), React.createElement(\"dd\", null, race || 'unk.'), React.createElement(\"dt\", null, \"Ethnicity\"), React.createElement(\"dd\", null, ethnicity || 'unk.'), React.createElement(\"dt\", null, \"Language\"), React.createElement(\"dd\", null, language || 'unk.'), React.createElement(\"dt\", null, \"Blood Type\"), React.createElement(\"dd\", null, \"unknown\"), patient.deceasedDateTime && React.createElement(React.Fragment, null, React.createElement(\"dt\", null, \"Cause of Death\"), React.createElement(\"dd\", null, cause_of_death_obs)))))));\n  }\n\n}\n\nclass GenericVisualizer extends React.Component {\n  /*\n    columns: [\n      { title: 'SNOMED', getter: (c) => c.code.coding[0].code, versions: ['1.0.2', '3.0.1', '4.0.0'] }\n    ],\n    rows: // fhir[]\n    keyFn: (c) => c.id\n  */\n  renderHeaderLine() {\n    const columns = this.props.columns.filter(c => c.versions === '*' || c.versions.includes(this.props.version)).map(c => c.title);\n    return columns.map(c => React.createElement(\"th\", {\n      scope: \"col\",\n      key: c\n    }, c));\n  }\n\n  renderBodyLine(line) {\n    const columns = this.props.columns.filter(c => c.versions === '*' || c.versions.includes(this.props.version));\n    const nestedRows = [];\n\n    if (this.props.nestedRows) {\n      for (const nestedRow of this.props.nestedRows) {\n        let subRowLines;\n\n        try {\n          subRowLines = nestedRow.getter(line);\n        } catch (e) {\n          subRowLines = undefined;\n        }\n\n        if (!subRowLines) continue;\n        const subColumns = nestedRow.columns.filter(c => c.versions === '*' || c.versions.includes(this.props.version));\n\n        for (const subRowLine of subRowLines) {\n          nestedRows.push(React.createElement(\"tr\", {\n            key: nestedRow.keyFn(subRowLine)\n          }, subColumns.map((c, i) => {\n            const formatter = FORMATTERS[c.format];\n            let result;\n\n            try {\n              result = c.getter(subRowLine);\n            } catch (e) {\n              result = undefined;\n            }\n\n            if (result && formatter) {\n              result = formatter(result);\n            }\n\n            if (!result && c.defaultValue) {\n              result = c.defaultValue;\n            }\n\n            return React.createElement(\"td\", {\n              key: i\n            }, result);\n          })));\n        }\n      }\n    }\n\n    return React.createElement(React.Fragment, {\n      key: this.props.keyFn(line)\n    }, React.createElement(\"tr\", {\n      className: this.props.rowClass || '',\n      key: this.props.keyFn(line)\n    }, columns.map((c, i) => {\n      const formatter = FORMATTERS[c.format];\n      let result;\n\n      try {\n        result = c.getter(line);\n      } catch (e) {\n        result = undefined;\n      }\n\n      if (result && formatter) {\n        result = formatter(result);\n      }\n\n      if (!result && c.defaultValue) {\n        result = c.defaultValue;\n      }\n\n      return React.createElement(\"td\", {\n        key: i\n      }, result);\n    })), nestedRows); // TODO: multi-liners\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: this.props.title\n    }, React.createElement(\"div\", {\n      className: \"health-record__header\"\n    }, React.createElement(\"div\", {\n      className: \"header-title\"\n    }, this.props.title), React.createElement(\"div\", {\n      className: \"header-divider\"\n    })), React.createElement(\"table\", {\n      className: \"table table-sm table-hover\"\n    }, React.createElement(\"thead\", {\n      id: `p_${this.props.title}_head`\n    }, React.createElement(\"tr\", null, this.renderHeaderLine())), React.createElement(\"tbody\", {\n      id: `p_${this.props.title}_list`\n    }, this.props.rows && this.props.rows.slice().reverse().map(c => this.renderBodyLine(c)))));\n  }\n\n}\n\nclass ConditionsVisualizer extends GenericVisualizer {}\n\n_defineProperty(ConditionsVisualizer, \"defaultProps\", {\n  title: 'Conditions',\n  columns: [{\n    title: 'SNOMED',\n    versions: '*',\n    getter: c => c.code.coding[0].code\n  }, {\n    title: 'Condition',\n    versions: '*',\n    getter: c => c.code.coding[0].display\n  }, {\n    title: 'Date of Onset',\n    versions: '*',\n    format: 'date',\n    getter: c => c.onsetDateTime\n  }, {\n    title: 'Date Resolved',\n    'versions': '*',\n    format: 'date',\n    getter: c => c.abatementDateTime,\n    defaultValue: 'N/A'\n  }],\n  keyFn: c => c.id\n});\n\nclass ObservationsVisualizer extends GenericVisualizer {}\n\n_defineProperty(ObservationsVisualizer, \"defaultProps\", {\n  title: 'Observations',\n  columns: [{\n    title: 'LOINC',\n    versions: '*',\n    getter: o => o.code.coding[0].code\n  }, {\n    title: 'Observation',\n    versions: '*',\n    getter: o => o.code.coding[0].display\n  }, {\n    title: 'Value',\n    versions: '*',\n    getter: o => obsValue(o)\n  }, {\n    title: 'Date Recorded',\n    'versions': '*',\n    format: 'date',\n    getter: o => o.effectiveDateTime\n  }],\n  keyFn: o => o.id\n});\n\nclass ReportsVisualizer extends GenericVisualizer {}\n\n_defineProperty(ReportsVisualizer, \"defaultProps\", {\n  title: 'Reports',\n  columns: [{\n    title: 'LOINC',\n    versions: '*',\n    getter: c => c.code.coding[0].code\n  }, {\n    title: 'Report/Observation',\n    versions: '*',\n    getter: c => c.code.coding[0].display\n  }, {\n    title: 'Value',\n    versions: '*',\n    getter: () => ''\n  }, {\n    title: 'Date',\n    'versions': '*',\n    format: 'date',\n    getter: c => c.effectiveDateTime,\n    defaultValue: 'N/A'\n  }],\n  rowClass: 'report-line',\n  nestedRows: [{\n    getter: rpt => rpt.observations,\n    keyFn: o => o.id,\n    columns: [{\n      title: 'LOINC',\n      versions: '*',\n      getter: o => o.code.coding[0].code\n    }, {\n      title: 'Report/Observation',\n      versions: '*',\n      getter: o => o.code.coding[0].display\n    }, {\n      title: 'Value',\n      versions: '*',\n      getter: o => obsValue(o)\n    }, {\n      title: 'Date',\n      versions: '*',\n      getter: o => ''\n    }]\n  }],\n  keyFn: r => r.id\n});\n\nclass MedicationsVisualizer extends GenericVisualizer {}\n\n_defineProperty(MedicationsVisualizer, \"defaultProps\", {\n  title: 'Medications',\n  columns: [{\n    title: 'RxNorm',\n    versions: '*',\n    getter: c => c.medicationCodeableConcept.coding[0].code\n  }, {\n    title: 'Medication',\n    versions: '*',\n    getter: c => c.medicationCodeableConcept.coding[0].display\n  }, {\n    title: 'Date Prescribed',\n    versions: '*',\n    format: 'date',\n    getter: c => c.authoredOn\n  }, {\n    title: 'Status',\n    'versions': '*',\n    getter: c => c.status\n  }],\n  keyFn: c => c.id\n});\n\nclass AllergiesVisualizer extends GenericVisualizer {}\n\n_defineProperty(AllergiesVisualizer, \"defaultProps\", {\n  title: 'Allergies',\n  columns: [{\n    title: 'SNOMED',\n    versions: '*',\n    getter: c => c.code.coding[0].code\n  }, {\n    title: 'Allergy',\n    versions: '*',\n    getter: c => c.code.coding[0].display\n  }, {\n    title: 'Date Recorded',\n    versions: [R4],\n    getter: c => c.recordedDate\n  }, {\n    title: 'Date Recorded',\n    versions: [DSTU2, STU3],\n    format: 'date',\n    getter: c => c.assertedDate\n  }],\n  keyFn: c => c.id\n});\n\nconst goalDescriptionDSTU2 = goal => {\n  if (goal.description) return goal.description;\n  return '';\n};\n\nconst goalDescriptionSTU3R4 = goal => {\n  if (goal.description) return goal.description.text;\n  return '';\n};\n\nclass CarePlansVisualizer extends GenericVisualizer {}\n\n_defineProperty(CarePlansVisualizer, \"defaultProps\", {\n  title: 'CarePlans',\n  columns: [{\n    title: 'SNOMED',\n    versions: '*',\n    getter: c => c.category[0].coding[0].code\n  }, {\n    title: 'Care Plan',\n    versions: '*',\n    getter: c => c.category[0].coding[0].display\n  }, {\n    title: 'Date',\n    versions: '*',\n    format: 'date',\n    getter: c => c.period.start\n  }],\n  nestedRows: [{\n    getter: cp => cp.goals,\n    keyFn: g => g.id,\n    columns: [{\n      title: '',\n      versions: '*',\n      getter: g => ''\n    }, {\n      title: 'Goal',\n      versions: [DSTU2],\n      getter: g => `Goal: ${goalDescriptionDSTU2(g)}`\n    }, {\n      title: 'Goal',\n      versions: [STU3, R4],\n      getter: g => `Goal: ${goalDescriptionSTU3R4(g)}`\n    }, {\n      title: '',\n      versions: '*',\n      getter: g => ''\n    }]\n  }, {\n    getter: cp => cp.activity,\n    keyFn: a => Math.random(),\n    columns: [{\n      title: '',\n      versions: '*',\n      getter: a => ''\n    }, {\n      title: 'Activity',\n      versions: '*',\n      getter: a => `Activity: ${a.detail.code.coding[0].display}`\n    }, {\n      title: '',\n      versions: '*',\n      getter: a => ''\n    }]\n  }],\n  keyFn: c => c.id\n});\n\nclass ProceduresVisualizer extends GenericVisualizer {}\n\n_defineProperty(ProceduresVisualizer, \"defaultProps\", {\n  title: 'Procedures',\n  columns: [{\n    title: 'SNOMED',\n    versions: '*',\n    getter: c => c.code.coding[0].code\n  }, {\n    title: 'Procedure',\n    versions: '*',\n    getter: c => c.code.coding[0].display\n  }, {\n    title: 'Date Performed',\n    versions: '*',\n    format: 'dateTime',\n    getter: c => c.performedPeriod.start\n  }],\n  keyFn: c => c.id\n});\n\nclass EncountersVisualizer extends GenericVisualizer {}\n\n_defineProperty(EncountersVisualizer, \"defaultProps\", {\n  title: 'Encounters',\n  columns: [{\n    title: 'SNOMED',\n    versions: '*',\n    getter: e => e.type[0].coding[0].code\n  }, {\n    title: 'Encounter',\n    versions: '*',\n    getter: e => e.type[0].coding[0].display\n  }, {\n    title: 'Start Time',\n    versions: '*',\n    format: 'dateTime',\n    getter: e => e.period.start\n  }, {\n    title: 'Duration',\n    'versions': '*',\n    getter: e => duration(e.period)\n  }],\n  keyFn: c => c.id\n});\n\nclass ImmunizationsVisualizer extends GenericVisualizer {}\n\n_defineProperty(ImmunizationsVisualizer, \"defaultProps\", {\n  title: 'Vaccinations',\n  columns: [{\n    title: 'CVX',\n    versions: '*',\n    getter: c => c.vaccineCode.coding[0].code\n  }, {\n    title: 'Vaccine',\n    versions: '*',\n    getter: c => c.vaccineCode.coding[0].display\n  }, {\n    title: 'Date Given',\n    versions: '*',\n    format: 'date',\n    getter: c => c.occurrenceDateTime\n  }],\n  keyFn: c => c.id\n});\n\nexport { AllergiesVisualizer, CarePlansVisualizer, ConditionsVisualizer, EncountersVisualizer, ImmunizationsVisualizer, MedicationsVisualizer, ObservationsVisualizer, PatientVisualizer, ProceduresVisualizer, ReportsVisualizer };","map":{"version":3,"sources":["C:/Users/abhijith.ponnapally/smart-react-app-template/node_modules/fhir-visualizers/build/index.js"],"names":["React","moment","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","DSTU2","STU3","R4","round","num","digits","Number","parseFloat","toFixed","FORMATTERS","date","str","format","time","dateTime","numberWithCommas","toString","replace","obsValue","entry","valueQuantity","code","valueCodeableConcept","coding","display","valueString","component","v1","v2","s1","s2","duration","period","end","start","diff","humanize","PatientVisualizer","Component","render","patient","props","extension","raceExt","find","e","url","race","valueCoding","ethExt","ethnicity","language","communication","observations","searchableObs","slice","reverse","height_obs","o","weight_obs","cause_of_death_obs","lat","lng","address","geolocation","length","valueDecimal","className","id","name","family","given","join","gender","birthDate","line","city","state","postalCode","deceasedDateTime","Fragment","GenericVisualizer","renderHeaderLine","columns","filter","c","versions","includes","version","map","title","scope","renderBodyLine","nestedRows","nestedRow","subRowLines","getter","undefined","subColumns","subRowLine","push","keyFn","i","formatter","result","defaultValue","rowClass","rows","ConditionsVisualizer","onsetDateTime","abatementDateTime","ObservationsVisualizer","effectiveDateTime","ReportsVisualizer","rpt","r","MedicationsVisualizer","medicationCodeableConcept","authoredOn","status","AllergiesVisualizer","recordedDate","assertedDate","goalDescriptionDSTU2","goal","description","goalDescriptionSTU3R4","text","CarePlansVisualizer","category","cp","goals","g","activity","a","Math","random","detail","ProceduresVisualizer","performedPeriod","EncountersVisualizer","ImmunizationsVisualizer","vaccineCode","occurrenceDateTime"],"mappings":"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","sourcesContent":["import React from 'react';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport moment from 'moment';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css = \".health-record__header {\\n  font-family: 'Open Sans', sans-serif;\\n  display: -ms-flexbox;\\n  display: flex;\\n  color: #6b8eb6;\\n  font-size: 1em;\\n  font-weight: bold;\\n  text-transform: uppercase;\\n  margin: 40px 0;\\n}\\n​\\n.health-record__header .header-divider {\\n  width: 100%;\\n  border-bottom: 1px solid #7e90a3;\\n  margin-bottom: 10px;\\n}\\n​\\n.report-line {\\n  background: #EAEAEA;\\n}\\n​\\ndl {\\n  margin-top:0;\\n  margin-bottom:20px\\n}\\n\\ndd,dt {\\n  line-height:1.42857\\n}\\n\\ndt {\\n  font-weight:700\\n}\\n\\ndd {\\n  margin-left:0\\n}\\n.dl-horizontal dd:after,.dl-horizontal dd:before {\\n  content:\\\" \\\";\\n  display:table\\n}\\n\\n.dl-horizontal dd:after {\\n  clear:both\\n}\\n\\n@media (min-width:768px) {\\n  .dl-horizontal dt {\\n    float:left;\\n    clear:left;\\n    text-align:right;\\n    overflow:hidden;\\n    text-overflow:ellipsis;\\n    white-space:nowrap\\n  }\\n  .dl-horizontal dd {\\n    margin-left:180px\\n  }\\n}\\n\";\nstyleInject(css);\n\nconst DSTU2 = '1.0.2';\nconst STU3 = '3.0.1';\nconst R4 = '4.0.0';\n\nconst round = function (num, digits) {\n  return Number.parseFloat(num).toFixed(digits);\n};\n\nconst FORMATTERS = {\n  date: str => moment(str).format('YYYY-MM-DD'),\n  time: str => moment(str).format('HH:mm:ss'),\n  dateTime: str => moment(str).format('YYYY-MM-DD - h:mm:ss a'),\n  numberWithCommas: str => str.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\")\n};\n\nconst obsValue = entry => {\n  if (entry == null) {\n    return '';\n  } else if (entry.valueQuantity) {\n    return round(entry.valueQuantity.value, 2) + ' ' + entry.valueQuantity.code;\n  } else if (entry.valueCodeableConcept) {\n    return entry.valueCodeableConcept.coding[0].display;\n  } else if (entry.valueString) {\n    return entry.valueString;\n  }\n\n  if (entry.code.coding[0].display === \"Blood Pressure\") {\n    if (!entry.component[0].valueQuantity) {\n      return ''; // WTF!!\n    }\n\n    const v1 = Number.parseFloat(entry.component[0].valueQuantity.value);\n    const v2 = Number.parseFloat(entry.component[1].valueQuantity.value);\n    const s1 = v1.toFixed(0);\n    const s2 = v2.toFixed(0);\n\n    if (v1 > v2) {\n      return s1 + ' / ' + s2 + ' mmHg';\n    } else {\n      return s2 + ' / ' + s1 + ' mmHg';\n    }\n  }\n\n  return '';\n};\n\nconst duration = period => {\n  if (!period.end) {\n    return '';\n  }\n\n  let start = moment(period.start);\n  let end = moment(period.end);\n  return moment.duration(start.diff(end)).humanize();\n};\n\nclass PatientVisualizer extends React.Component {\n  render() {\n    const patient = this.props.patient;\n    patient.extension = patient.extension || [];\n    const raceExt = patient.extension.find(e => {\n      return e.url === 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-race';\n    });\n    let race;\n\n    if (raceExt) {\n      race = raceExt.extension[0].valueString || raceExt.extension[0].valueCoding.display;\n    } else {\n      race = null;\n    }\n\n    const ethExt = patient.extension.find(e => {\n      return e.url === 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity';\n    });\n    let ethnicity;\n\n    if (ethExt) {\n      ethnicity = ethExt.extension[0].valueString || ethExt.extension[0].valueCoding.display;\n    } else {\n      ethnicity = null;\n    }\n\n    let language = null;\n\n    if (patient.communication && patient.communication[0] && patient.communication[0].language && patient.communication[0].language.coding && patient.communication[0].language.coding[0]) {\n      language = patient.communication[0].language.coding[0].display;\n    }\n\n    const observations = this.props.observations || [];\n    const searchableObs = observations.slice().reverse();\n    const height_obs = searchableObs.find(o => o.code.coding[0].display === 'Body Height');\n    const weight_obs = searchableObs.find(o => o.code.coding[0].display === 'Body Weight');\n    const cause_of_death_obs = null;\n    let lat, lng;\n\n    if (patient.address[0].extension) {\n      const geolocation = patient.address[0].extension.find(e => e.url === 'http://hl7.org/fhir/StructureDefinition/geolocation');\n\n      if (geolocation && geolocation.extension.length > 1) {\n        lat = geolocation.extension.find(e => e.url === 'latitude').valueDecimal;\n        lng = geolocation.extension.find(e => e.url === 'longitude').valueDecimal;\n      }\n    }\n\n    return React.createElement(\"div\", null, React.createElement(\"div\", {\n      className: \"health-record__header\"\n    }, React.createElement(\"div\", {\n      className: \"header-title\"\n    }, \"Patient\"), React.createElement(\"div\", {\n      className: \"header-divider\"\n    })), React.createElement(\"div\", {\n      id: \"p_brief\",\n      className: \"row\"\n    }, React.createElement(\"div\", {\n      id: \"p_brief_records\",\n      className: \"col-6\"\n    }, React.createElement(\"div\", {\n      id: \"p_brief_name_address\",\n      className: \"p_block\"\n    }, React.createElement(\"dl\", {\n      className: \"dl-horizontal p_brief_family\"\n    }, React.createElement(\"dt\", null, \"Name\"), React.createElement(\"dd\", null, patient.name[0].family, \", \", patient.name[0].given.join(' ')), React.createElement(\"dt\", null, \"Gender\"), React.createElement(\"dd\", null, patient.gender), React.createElement(\"dt\", null, \"Date of Birth\"), React.createElement(\"dd\", null, patient.birthDate), React.createElement(\"dt\", null, \"Address\"), React.createElement(\"dd\", null, patient.address[0].line.join(' ')), React.createElement(\"dt\", null, \"City, State\"), React.createElement(\"dd\", null, patient.address[0].city, \", \", patient.address[0].state), React.createElement(\"dt\", null, \"Postal Code\"), React.createElement(\"dd\", null, patient.address[0].postalCode), patient.deceasedDateTime && React.createElement(React.Fragment, null, React.createElement(\"dt\", null, \"Date of Death\"), React.createElement(\"dd\", null, patient.deceasedDateTime))))), React.createElement(\"div\", {\n      id: \"p_brief_records\",\n      className: \"col-6\"\n    }, React.createElement(\"div\", {\n      id: \"p_brief_name_address\",\n      className: \"p_block\"\n    }, React.createElement(\"dl\", {\n      className: \"dl-horizontal p_brief_family\"\n    }, React.createElement(\"dt\", null, \"Height\"), React.createElement(\"dd\", null, obsValue(height_obs)), React.createElement(\"dt\", null, \"Weight\"), React.createElement(\"dd\", null, obsValue(weight_obs)), React.createElement(\"dt\", null, \"Race\"), React.createElement(\"dd\", null, race || 'unk.'), React.createElement(\"dt\", null, \"Ethnicity\"), React.createElement(\"dd\", null, ethnicity || 'unk.'), React.createElement(\"dt\", null, \"Language\"), React.createElement(\"dd\", null, language || 'unk.'), React.createElement(\"dt\", null, \"Blood Type\"), React.createElement(\"dd\", null, \"unknown\"), patient.deceasedDateTime && React.createElement(React.Fragment, null, React.createElement(\"dt\", null, \"Cause of Death\"), React.createElement(\"dd\", null, cause_of_death_obs)))))));\n  }\n\n}\n\nclass GenericVisualizer extends React.Component {\n  /*\n    columns: [\n      { title: 'SNOMED', getter: (c) => c.code.coding[0].code, versions: ['1.0.2', '3.0.1', '4.0.0'] }\n    ],\n    rows: // fhir[]\n    keyFn: (c) => c.id\n  */\n  renderHeaderLine() {\n    const columns = this.props.columns.filter(c => c.versions === '*' || c.versions.includes(this.props.version)).map(c => c.title);\n    return columns.map(c => React.createElement(\"th\", {\n      scope: \"col\",\n      key: c\n    }, c));\n  }\n\n  renderBodyLine(line) {\n    const columns = this.props.columns.filter(c => c.versions === '*' || c.versions.includes(this.props.version));\n    const nestedRows = [];\n\n    if (this.props.nestedRows) {\n      for (const nestedRow of this.props.nestedRows) {\n        let subRowLines;\n\n        try {\n          subRowLines = nestedRow.getter(line);\n        } catch (e) {\n          subRowLines = undefined;\n        }\n\n        if (!subRowLines) continue;\n        const subColumns = nestedRow.columns.filter(c => c.versions === '*' || c.versions.includes(this.props.version));\n\n        for (const subRowLine of subRowLines) {\n          nestedRows.push(React.createElement(\"tr\", {\n            key: nestedRow.keyFn(subRowLine)\n          }, subColumns.map((c, i) => {\n            const formatter = FORMATTERS[c.format];\n            let result;\n\n            try {\n              result = c.getter(subRowLine);\n            } catch (e) {\n              result = undefined;\n            }\n\n            if (result && formatter) {\n              result = formatter(result);\n            }\n\n            if (!result && c.defaultValue) {\n              result = c.defaultValue;\n            }\n\n            return React.createElement(\"td\", {\n              key: i\n            }, result);\n          })));\n        }\n      }\n    }\n\n    return React.createElement(React.Fragment, {\n      key: this.props.keyFn(line)\n    }, React.createElement(\"tr\", {\n      className: this.props.rowClass || '',\n      key: this.props.keyFn(line)\n    }, columns.map((c, i) => {\n      const formatter = FORMATTERS[c.format];\n      let result;\n\n      try {\n        result = c.getter(line);\n      } catch (e) {\n        result = undefined;\n      }\n\n      if (result && formatter) {\n        result = formatter(result);\n      }\n\n      if (!result && c.defaultValue) {\n        result = c.defaultValue;\n      }\n\n      return React.createElement(\"td\", {\n        key: i\n      }, result);\n    })), nestedRows); // TODO: multi-liners\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: this.props.title\n    }, React.createElement(\"div\", {\n      className: \"health-record__header\"\n    }, React.createElement(\"div\", {\n      className: \"header-title\"\n    }, this.props.title), React.createElement(\"div\", {\n      className: \"header-divider\"\n    })), React.createElement(\"table\", {\n      className: \"table table-sm table-hover\"\n    }, React.createElement(\"thead\", {\n      id: `p_${this.props.title}_head`\n    }, React.createElement(\"tr\", null, this.renderHeaderLine())), React.createElement(\"tbody\", {\n      id: `p_${this.props.title}_list`\n    }, this.props.rows && this.props.rows.slice().reverse().map(c => this.renderBodyLine(c)))));\n  }\n\n}\n\nclass ConditionsVisualizer extends GenericVisualizer {}\n\n_defineProperty(ConditionsVisualizer, \"defaultProps\", {\n  title: 'Conditions',\n  columns: [{\n    title: 'SNOMED',\n    versions: '*',\n    getter: c => c.code.coding[0].code\n  }, {\n    title: 'Condition',\n    versions: '*',\n    getter: c => c.code.coding[0].display\n  }, {\n    title: 'Date of Onset',\n    versions: '*',\n    format: 'date',\n    getter: c => c.onsetDateTime\n  }, {\n    title: 'Date Resolved',\n    'versions': '*',\n    format: 'date',\n    getter: c => c.abatementDateTime,\n    defaultValue: 'N/A'\n  }],\n  keyFn: c => c.id\n});\n\nclass ObservationsVisualizer extends GenericVisualizer {}\n\n_defineProperty(ObservationsVisualizer, \"defaultProps\", {\n  title: 'Observations',\n  columns: [{\n    title: 'LOINC',\n    versions: '*',\n    getter: o => o.code.coding[0].code\n  }, {\n    title: 'Observation',\n    versions: '*',\n    getter: o => o.code.coding[0].display\n  }, {\n    title: 'Value',\n    versions: '*',\n    getter: o => obsValue(o)\n  }, {\n    title: 'Date Recorded',\n    'versions': '*',\n    format: 'date',\n    getter: o => o.effectiveDateTime\n  }],\n  keyFn: o => o.id\n});\n\nclass ReportsVisualizer extends GenericVisualizer {}\n\n_defineProperty(ReportsVisualizer, \"defaultProps\", {\n  title: 'Reports',\n  columns: [{\n    title: 'LOINC',\n    versions: '*',\n    getter: c => c.code.coding[0].code\n  }, {\n    title: 'Report/Observation',\n    versions: '*',\n    getter: c => c.code.coding[0].display\n  }, {\n    title: 'Value',\n    versions: '*',\n    getter: () => ''\n  }, {\n    title: 'Date',\n    'versions': '*',\n    format: 'date',\n    getter: c => c.effectiveDateTime,\n    defaultValue: 'N/A'\n  }],\n  rowClass: 'report-line',\n  nestedRows: [{\n    getter: rpt => rpt.observations,\n    keyFn: o => o.id,\n    columns: [{\n      title: 'LOINC',\n      versions: '*',\n      getter: o => o.code.coding[0].code\n    }, {\n      title: 'Report/Observation',\n      versions: '*',\n      getter: o => o.code.coding[0].display\n    }, {\n      title: 'Value',\n      versions: '*',\n      getter: o => obsValue(o)\n    }, {\n      title: 'Date',\n      versions: '*',\n      getter: o => ''\n    }]\n  }],\n  keyFn: r => r.id\n});\n\nclass MedicationsVisualizer extends GenericVisualizer {}\n\n_defineProperty(MedicationsVisualizer, \"defaultProps\", {\n  title: 'Medications',\n  columns: [{\n    title: 'RxNorm',\n    versions: '*',\n    getter: c => c.medicationCodeableConcept.coding[0].code\n  }, {\n    title: 'Medication',\n    versions: '*',\n    getter: c => c.medicationCodeableConcept.coding[0].display\n  }, {\n    title: 'Date Prescribed',\n    versions: '*',\n    format: 'date',\n    getter: c => c.authoredOn\n  }, {\n    title: 'Status',\n    'versions': '*',\n    getter: c => c.status\n  }],\n  keyFn: c => c.id\n});\n\nclass AllergiesVisualizer extends GenericVisualizer {}\n\n_defineProperty(AllergiesVisualizer, \"defaultProps\", {\n  title: 'Allergies',\n  columns: [{\n    title: 'SNOMED',\n    versions: '*',\n    getter: c => c.code.coding[0].code\n  }, {\n    title: 'Allergy',\n    versions: '*',\n    getter: c => c.code.coding[0].display\n  }, {\n    title: 'Date Recorded',\n    versions: [R4],\n    getter: c => c.recordedDate\n  }, {\n    title: 'Date Recorded',\n    versions: [DSTU2, STU3],\n    format: 'date',\n    getter: c => c.assertedDate\n  }],\n  keyFn: c => c.id\n});\n\nconst goalDescriptionDSTU2 = goal => {\n  if (goal.description) return goal.description;\n  return '';\n};\n\nconst goalDescriptionSTU3R4 = goal => {\n  if (goal.description) return goal.description.text;\n  return '';\n};\n\nclass CarePlansVisualizer extends GenericVisualizer {}\n\n_defineProperty(CarePlansVisualizer, \"defaultProps\", {\n  title: 'CarePlans',\n  columns: [{\n    title: 'SNOMED',\n    versions: '*',\n    getter: c => c.category[0].coding[0].code\n  }, {\n    title: 'Care Plan',\n    versions: '*',\n    getter: c => c.category[0].coding[0].display\n  }, {\n    title: 'Date',\n    versions: '*',\n    format: 'date',\n    getter: c => c.period.start\n  }],\n  nestedRows: [{\n    getter: cp => cp.goals,\n    keyFn: g => g.id,\n    columns: [{\n      title: '',\n      versions: '*',\n      getter: g => ''\n    }, {\n      title: 'Goal',\n      versions: [DSTU2],\n      getter: g => `Goal: ${goalDescriptionDSTU2(g)}`\n    }, {\n      title: 'Goal',\n      versions: [STU3, R4],\n      getter: g => `Goal: ${goalDescriptionSTU3R4(g)}`\n    }, {\n      title: '',\n      versions: '*',\n      getter: g => ''\n    }]\n  }, {\n    getter: cp => cp.activity,\n    keyFn: a => Math.random(),\n    columns: [{\n      title: '',\n      versions: '*',\n      getter: a => ''\n    }, {\n      title: 'Activity',\n      versions: '*',\n      getter: a => `Activity: ${a.detail.code.coding[0].display}`\n    }, {\n      title: '',\n      versions: '*',\n      getter: a => ''\n    }]\n  }],\n  keyFn: c => c.id\n});\n\nclass ProceduresVisualizer extends GenericVisualizer {}\n\n_defineProperty(ProceduresVisualizer, \"defaultProps\", {\n  title: 'Procedures',\n  columns: [{\n    title: 'SNOMED',\n    versions: '*',\n    getter: c => c.code.coding[0].code\n  }, {\n    title: 'Procedure',\n    versions: '*',\n    getter: c => c.code.coding[0].display\n  }, {\n    title: 'Date Performed',\n    versions: '*',\n    format: 'dateTime',\n    getter: c => c.performedPeriod.start\n  }],\n  keyFn: c => c.id\n});\n\nclass EncountersVisualizer extends GenericVisualizer {}\n\n_defineProperty(EncountersVisualizer, \"defaultProps\", {\n  title: 'Encounters',\n  columns: [{\n    title: 'SNOMED',\n    versions: '*',\n    getter: e => e.type[0].coding[0].code\n  }, {\n    title: 'Encounter',\n    versions: '*',\n    getter: e => e.type[0].coding[0].display\n  }, {\n    title: 'Start Time',\n    versions: '*',\n    format: 'dateTime',\n    getter: e => e.period.start\n  }, {\n    title: 'Duration',\n    'versions': '*',\n    getter: e => duration(e.period)\n  }],\n  keyFn: c => c.id\n});\n\nclass ImmunizationsVisualizer extends GenericVisualizer {}\n\n_defineProperty(ImmunizationsVisualizer, \"defaultProps\", {\n  title: 'Vaccinations',\n  columns: [{\n    title: 'CVX',\n    versions: '*',\n    getter: c => c.vaccineCode.coding[0].code\n  }, {\n    title: 'Vaccine',\n    versions: '*',\n    getter: c => c.vaccineCode.coding[0].display\n  }, {\n    title: 'Date Given',\n    versions: '*',\n    format: 'date',\n    getter: c => c.occurrenceDateTime\n  }],\n  keyFn: c => c.id\n});\n\nexport { AllergiesVisualizer, CarePlansVisualizer, ConditionsVisualizer, EncountersVisualizer, ImmunizationsVisualizer, MedicationsVisualizer, ObservationsVisualizer, PatientVisualizer, ProceduresVisualizer, ReportsVisualizer };\n"]},"metadata":{},"sourceType":"module"}